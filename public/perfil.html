<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil - TimeRight</title>
    <link href="https://fonts.googleapis.com/css2?family=Audrey:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="/" class="logo">TimeRight</a>
            <div class="nav-links">
                <a href="/">Home</a>
                <a href="/servicos.html">Serviços</a>
                <a href="/sobre.html">Sobre</a>
                <a href="/contato.html">Contato</a>
                <div id="user-menu">
                    <span id="user-name"></span>
                    <a href="/perfil.html">Perfil</a>
                    <button onclick="logout()">Sair</button>
                </div>
            </div>
        </div>
    </nav>

    <main class="profile-page">
        <div class="container">
            <h2>Meu Perfil</h2>
            
            <div class="profile-info">
                <h3>Informações Pessoais</h3>
                <div id="user-info">
                    <!-- User info loaded by JavaScript -->
                </div>
            </div>
            
            <div class="bookings-section">
                <h3>Meus Agendamentos</h3>
                <div id="bookings-list">
                    <!-- Bookings loaded by JavaScript -->
                </div>
            </div>
        </div>
    </main>

    <script>
        // Check authentication
        async function checkAuth() {
            try {
                const response = await fetch('/api/user');
                const data = await response.json();
                
                if (!data.success) {
                    window.location.href = '/login.html';
                    return;
                }
                
                document.getElementById('user-name').textContent = data.user.name;
                document.getElementById('user-info').innerHTML = `
                    <p><strong>Nome:</strong> ${data.user.name}</p>
                    <p><strong>Email:</strong> ${data.user.email}</p>
                `;
                
                loadBookings();
            } catch (error) {
                window.location.href = '/login.html';
            }
        }
        
        async function loadBookings() {
            try {
                const response = await fetch('/api/bookings');
                const data = await response.json();
                
                if (data.success && data.data.length > 0) {
                    const bookingsHtml = data.data.map(booking => `
                        <div class="booking-card">
                            <h4>${booking.service_name}</h4>
                            <p>Profissional: ${booking.professional_name}</p>
                            <p>Data: ${booking.booking_date}</p>
                            <p>Horário: ${booking.booking_time}</p>
                            <p>Preço: R$ ${booking.price}</p>
                            <span class="status ${booking.status}">${booking.status}</span>
                        </div>
                    `).join('');
                    
                    document.getElementById('bookings-list').innerHTML = bookingsHtml;
                } else {
                    document.getElementById('bookings-list').innerHTML = '<p>Nenhum agendamento encontrado.</p>';
                }
            } catch (error) {
                document.getElementById('bookings-list').innerHTML = '<p>Erro ao carregar agendamentos.</p>';
            }
        }
        
        async function logout() {
            try {
                await fetch('/api/logout', { method: 'POST' });
                window.location.href = '/';
            } catch (error) {
                window.location.href = '/';
            }
        }
        
        checkAuth();
    </script>
</body>
</html>